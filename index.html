<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¿€é—˜ï¼æ³•å»·å¼è­·å£«ã‚¬ãƒãƒ£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif JP', serif;
            background-color: #1a1a1a;
            color: #e5e5e5;
            overflow-x: hidden;
        }
        
        /* æ±ç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .pulse-gold { animation: pulse-gold 2s infinite; }
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }

        .rainbow-bg {
            background: linear-gradient(124deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
            background-size: 1800% 1800%;
            animation: rainbow 4s ease infinite;
        }
        @keyframes rainbow { 
            0% { background-position: 0% 82% }
            50% { background-position: 100% 19% }
            100% { background-position: 0% 82% }
        }

        .shine-effect {
            position: relative;
            overflow: hidden;
        }
        .shine-effect::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 40%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.1) 60%, rgba(255,255,255,0) 100%);
            transform: rotate(30deg);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }

        /* ãƒ¬ã‚¢ãƒªãƒ†ã‚£åˆ¥ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .card-C { border: 2px solid #a3a3a3; background: #262626; }
        .card-R { border: 2px solid #60a5fa; background: #1e3a8a; box-shadow: 0 0 10px rgba(96, 165, 250, 0.3); }
        .card-SR { border: 2px solid #fbbf24; background: #451a03; box-shadow: 0 0 15px rgba(251, 191, 36, 0.5); }
        .card-SSR { 
            border: 4px solid #fff; 
            background: linear-gradient(135deg, #000 0%, #333 100%);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 40px rgba(234, 179, 8, 0.6);
            animation: ssr-border 2s infinite alternate;
        }
        @keyframes ssr-border {
            0% { border-color: #ffd700; }
            100% { border-color: #fff; }
        }

        /* ç™»å ´æ™‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .flash-bang {
            animation: flash 0.2s ease-out;
        }
        @keyframes flash {
            0% { background-color: white; opacity: 1; }
            100% { background-color: transparent; opacity: 0; }
        }

        /* ç´™å¹é›ª */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ffd700;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

        /* UIåˆ¶å¾¡ */
        .hidden { display: none !important; }
    </style>
</head>
<body class="flex flex-col h-screen items-center justify-center bg-stone-900">

    <!-- èƒŒæ™¯è£…é£¾ -->
    <div class="fixed inset-0 pointer-events-none opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'0 0 2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%239C92AC\' fill-opacity=\'0.4\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>

    <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
    <div id="main-screen" class="z-10 text-center w-full max-w-2xl px-4">
        <h1 class="text-5xl md:text-6xl font-black mb-2 text-yellow-500 tracking-tighter drop-shadow-lg">
            æ¿€é—˜ï¼<br><span class="text-white text-4xl md:text-5xl">æ³•å»·å¼è­·å£«ã‚¬ãƒãƒ£</span>
        </h1>
        <p class="text-stone-400 mb-8 font-bold tracking-widest">JUDGEMENT GACHA SYSTEM</p>

        <div class="bg-stone-800 p-6 rounded-lg border border-stone-600 shadow-2xl mb-8">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="pullGacha(1)" class="relative group overflow-hidden bg-stone-700 hover:bg-stone-600 border border-stone-500 text-white font-bold py-4 px-6 rounded transition-all transform hover:scale-105 active:scale-95">
                    <span class="relative z-10 text-xl">å˜ç™ºé–‹å»·</span>
                    <span class="text-xs block text-stone-400">1å› 300å††(å˜˜)</span>
                    <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                </button>
                <button onclick="pullGacha(10)" class="relative group overflow-hidden bg-gradient-to-br from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 border border-yellow-400 text-white font-bold py-4 px-6 rounded transition-all transform hover:scale-105 active:scale-95 pulse-gold">
                    <span class="relative z-10 text-xl drop-shadow-md">10é€£é–‹å»·</span>
                    <span class="text-xs block text-yellow-200">SRä»¥ä¸Š1æšç¢ºå®šã‹ã‚‚</span>
                    <div class="absolute inset-0 shine-effect opacity-0 group-hover:opacity-100"></div>
                </button>
            </div>
        </div>

        <div class="flex justify-center gap-4">
            <button onclick="toggleHistory()" class="text-stone-400 hover:text-white underline text-sm">ç²å¾—ã—ãŸå¼è­·å£«ä¸€è¦§</button>
            <button onclick="resetData()" class="text-red-900 hover:text-red-700 underline text-sm">ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–</button>
        </div>
    </div>

    <!-- æ¼”å‡ºç”»é¢ -->
    <div id="animation-screen" class="hidden fixed inset-0 z-50 bg-black flex flex-col items-center justify-center pointer-events-none">
        <!-- ãƒ†ã‚­ã‚¹ãƒˆæ¼”å‡ºç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="anim-text-container" class="absolute inset-0 flex items-center justify-center overflow-hidden">
            <!-- JSã§å‹•çš„ã«è¿½åŠ  -->
        </div>
        
        <!-- ã‚¬ãƒ™ãƒ«ï¼ˆæœ¨æ§Œï¼‰ã‚¢ã‚¤ã‚³ãƒ³ -->
        <div id="gavel-icon" class="text-9xl text-stone-200 opacity-0 transform rotate-45 transition-all duration-300">
            ğŸ”¨
        </div>
        
        <!-- é–ƒå…‰ -->
        <div id="flash-overlay" class="absolute inset-0 bg-white opacity-0 pointer-events-none"></div>
    </div>

    <!-- çµæœç”»é¢ -->
    <div id="result-screen" class="hidden fixed inset-0 z-40 bg-black/90 flex flex-col items-center justify-center overflow-y-auto py-10">
        <h2 id="result-title" class="text-3xl text-yellow-500 font-bold mb-6 mt-10 opacity-0 transition-opacity duration-1000">é–‹å»·çµæœ</h2>
        
        <!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="cards-container" class="grid grid-cols-2 md:grid-cols-5 gap-4 px-4 w-full max-w-6xl mb-8">
            <!-- ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
        </div>

        <div class="flex gap-4 mt-4 mb-10 opacity-0 transition-opacity duration-1000" id="result-buttons">
            <button onclick="closeResult()" class="bg-white text-black font-bold py-3 px-8 rounded hover:bg-gray-200">é–‰å»·</button>
            <button onclick="retryGacha()" class="bg-yellow-600 text-white font-bold py-3 px-8 rounded hover:bg-yellow-500">å†å¯©è«‹æ±‚ (ã‚‚ã†ä¸€åº¦)</button>
        </div>
    </div>

    <!-- å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="history-modal" class="hidden fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4">
        <div class="bg-stone-800 w-full max-w-4xl max-h-[80vh] rounded-lg border border-stone-600 flex flex-col shadow-2xl">
            <div class="p-4 border-b border-stone-600 flex justify-between items-center">
                <h2 class="text-xl text-yellow-500 font-bold">å¼è­·å£«åé‘‘</h2>
                <button onclick="toggleHistory()" class="text-stone-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="history-content" class="p-4 overflow-y-auto flex-1 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                <!-- å±¥æ­´ãƒªã‚¹ãƒˆ -->
            </div>
        </div>
    </div>

    <script>
        // === ãƒ‡ãƒ¼ã‚¿å®šç¾© (CSVã‹ã‚‰å¤‰æ›) ===
        // ãƒ¬ã‚¢ãƒªãƒ†ã‚£: SSR(3%), SR(12%), R(35%), C(50%)
        const CHARACTERS = [
            { rarity: 'SSR', name: 'çŸ³æ²¹ç‹å¼è­·å£«', line: 'ã‚ªã‚¤ãƒ«ãƒãƒãƒ¼ã§è£åˆ¤å®˜ã«ä¾¿å®œã‚’å›³ã‚‹ãœ' },
            { rarity: 'SSR', name: 'å›½é¸å¼è­·äºº', line: 'ç§ã«ä»»ã›ã¦ãã ã•ã„' },
            { rarity: 'SSR', name: 'æ¤œå¯Ÿå®˜', line: 'å›³ã‚Šã¾ã™ã‚ˆã€‚å¸æ³•ã‚’ã­' },
            { rarity: 'SSR', name: 'è£åˆ¤å“¡', line: 'çªƒç›—ã¯ã„ã‘ãªã„ã®ã§æ­»åˆ‘ã§ã„ã„ã¨æ€ã£ãŸ' },
            { rarity: 'SSR', name: 'äººèªç¦æ­¢å¼è­·äºº', line: 'ğ¦…™å½ç¹§ï¾–' },
            { rarity: 'SR', name: 'é»’é–ƒå¼è­·äºº', line: 'ãƒ¼ãƒ¼è£åˆ¤ã®æ ¸å¿ƒã‚’ã¤ã‹ã‚€' },
            { rarity: 'SR', name: 'ãƒ™ãƒ†ãƒ©ãƒ³å¼è­·å£«', line: 'ä»Šåº¦ã¯ã©ã‚“ãªæ¡ˆä»¶ã ï¼Ÿ' },
            { rarity: 'SR', name: 'è­¦å¯Ÿ', line: 'å¼è­·å£«æŠ½é¸ç½ªã§é€®æ•ã—ã¾ã™' },
            { rarity: 'SR', name: 'æˆæ­©å ‚é¾äºŒ', line: 'ã“ã“ã«ã¯ãŸãã•ã‚“ã®ç•°è­°ãŒã‚ã‚Šã¾ã™' },
            { rarity: 'SR', name: 'æ­´æˆ¦ã®å¼è­·å£«', line: 'å¿…ãšå‹ã¡ã¾ã—ã‚‡ã†' },
            { rarity: 'SR', name: 'å¼è­·å£«ã‚¢ãƒ³ãƒªãƒŸãƒ†ãƒƒãƒ‰', line: 'ï¼‘ã‹æœˆé–“æœ€é«˜ã®å¼è­·ã‚’ä½“é¨“' },
            { rarity: 'SR', name: 'å¼å¼è­·è­·å£«å£«', line: 'äºŒå€å¼è­·ã§ãã‚‹ã' },
            { rarity: 'R', name: 'ãƒãƒ¼ã‚µãƒ¼ã‚«ãƒ¼å¼è­·å£«', line: 'æ¤œå¯Ÿã‚’å€’ã›ã°ã„ã„ã‚“ã ã‚' },
            { rarity: 'R', name: 'ãƒ¤ãƒ–å¼è­·å£«', line: 'å¼è­·å£«ãƒãƒƒãƒï¼’å€‹ã‚‚æŒã£ã¦ã¾ã™ã‚ˆ' },
            { rarity: 'R', name: 'ãƒ•ãƒªãƒ¼å¼è­·å£«', line: '(ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ãŒã¤ã„ã¦ã„ã‚‹)' },
            { rarity: 'R', name: 'çœŸå¼è­·å£«', line: 'çœŸã®æ³•å¾‹ã§çœŸã®å‹è¨´ã‚’ç›®æŒ‡ã™' },
            { rarity: 'R', name: 'ã‚¹ã‚±å¼è­·å£«', line: 'ï½²ï½´ï½ªï½ªï½ªï½ªï½´ï½²' },
            { rarity: 'R', name: 'ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰å¼è­·å£«', line: 'å‹•ç”»ã‚’è¦‹ã¦å‹è¨´ã«å–ã‚Šçµ„ã‚“ã§ãã ã•ã„' },
            { rarity: 'R', name: 'ãƒ©ã‚°å¼è­·å£«', line: 'ã“ã‚Œã‚ˆã‚Šå¼è­·ã“ã‚Œã‚ˆã“ã‚Œã‚ˆã‚Šå¼è­·ã‚’ã¯ã˜ã‚ã“ã‚Œã“ã‚Œã“ã‚Œã“ã‚Œã“ã‚Œã“ã‚Œã‚ˆã‚Šã“ã‚Œ' },
            { rarity: 'R', name: 'PayPayå¼è­·å£«', line: 'ï½½ï½¸ï¾—ï½¯ï¾ï¾ï½¬ï¾ï½½!!!' },
            { rarity: 'R', name: 'é»’ãƒãƒƒã‚·ãƒ¥å¼è­·å£«', line: 'æ¤œå¯Ÿã•ã‚“å³ã—ï½wwã€€ã‚“ãƒ¼ãã‚Œã¯åŸå‘Šã•ã‚“ãŒæ‚ªã„ã‚' },
            { rarity: 'R', name: 'èµ¤å¼è­·å£«', line: 'ç«ã«å¼·ã„' },
            { rarity: 'R', name: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ©ãƒ³å¼è­·å£«', line: 'é€”ä¸­ã§åºƒå‘ŠãŒæŒŸã¾ã‚‹' },
            { rarity: 'R', name: 'æ§å¼è­·å£«', line: 'ä¸­è·é›¢ã§å¼·ã„' },
            { rarity: 'R', name: 'æŒ‡ç¤ºå¨å¼è­·å£«', line: 'ãˆï¼ãã“é»™ç§˜ã ã£ã¦' },
            { rarity: 'C', name: 'ãƒ‡ã‚³ã‚¤å¼è­·å£«', line: 'å¼è­·å£«ã®ãµã‚Šã‚’ã—ã¦ç›¸æ‰‹ã‚’ãŠã³ãå¯„ã›ã¾ã™' },
            { rarity: 'C', name: 'å˜˜å¼è­·å£«', line: 'å®Ÿã¯ã€è¢«å‘Šäººã“ããŒæ®ºäººã®è¢«å®³è€…ãªã®ã§ã™' },
            { rarity: 'C', name: 'é€†å¼è­·å£«', line: 'è¢«å‘Šäººã®åˆ‘ã‚’ã•ã‚‰ã«é‡ãã™ã‚‹ã“ã¨ã‚’è¦æ±‚ã—ã¾ã™' },
            { rarity: 'C', name: 'çŠ¯ç½ªç³»å¼è­·å£«', line: 'æœ€è¿‘ç§ã‚‚æ³•ã‚’çŠ¯ã—ãŸã®ã§ãã®æ°—æŒã¡ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™' },
            { rarity: 'C', name: 'å¼è­·ãƒå£«ãƒ³', line: '1999å¹´è£½é€ ã€€æ±ºé—˜ç½ªã«ã®ã¿å¯¾å¿œ' },
            { rarity: 'C', name: 'è‚‰ä½“æ´¾å¼è­·å£«', line: 'è£åˆ¤é•·ã‚ˆã‚Šã‚¬ã‚¿ã‚¤ãŒã„ã„ã€‚æ³•ã‚’ã¤ã‹ã•ã©ã‚‹ã®ã¯ã§ã‹ã„ã‚„ã¤ã ãœ' },
            { rarity: 'C', name: 'è„±æ³•å¼è­·å£«', line: 'ãã‚“ãªæ³•å¾‹ã€ç§ã«ã¯åŠ¹ã‹ãªã„' },
            { rarity: 'C', name: 'å¼è­·å£«(è‡ªç„¶ç”Ÿæˆ)', line: 'å¼è­·å£«ã‚‚ã‚ªãƒ¼ã‚¬ãƒ‹ãƒƒã‚¯ãŒä¸€ç•ªã§ã™' },
            { rarity: 'C', name: 'å°å­¦ç”Ÿæ™‚ä»£çµ¦é£Ÿã«å‡ºã¦ããŸã‚ªãƒ¬ãƒ³ã‚¸ã‚’å£ã«ãã‚ãˆã¦ãµã–ã‘ã¦ã„ãŸäººã‚’é›†ã‚ã¦ãƒ‡ã‚¹ã‚²ãƒ¼ãƒ ã‚’é–‹å‚¬ã—ãŸã„å¼è­·å£«', line: 'é–‹å‚¬ã—ãŸã„' },
            { rarity: 'C', name: 'ãƒãƒƒãƒˆæ°‘', line: 'å¼è­·ã¯ãƒ¯ã‚¤ã‚‰ã«ä»»ã›ã‚‹ã‚„ã§' },
            { rarity: 'C', name: 'ã‚¨ãƒƒãƒãªå¼è­·å£«ï¼”é¸', line: 'ã‚¨ãƒƒãƒå¼è­·å£«ã¯ã€ã‚¨ãƒƒãƒï¼' },
            { rarity: 'C', name: 'éæ­£è¦é›‡ç”¨å¼è­·å£«', line: '(æŒ‡ç¤ºå¾…ã¡ã‚’ã—ã¦ã„ã‚‹)' },
            { rarity: 'C', name: 'è£å¼è­·å£«', line: 'è¦‹ãŸã“ã¨ã­ã‡å¼è­·è¦‹ã›ã¦ã‚„ã‚‹ã‚ˆ' },
            { rarity: 'C', name: 'è©¦è¡Œå›æ•°å¼è­·å£«', line: '100å›å¼è­·ã™ã‚Œã°ã€ã„ã¤ã‹ã¯å‹è¨´ã§ãã‚‹ã£ã¦ã‚ã‘ã§ã™' },
            { rarity: 'C', name: 'Temuå¼è­·å£«', line: '12å††(é€æ–™è¾¼ã¿)' },
            { rarity: 'C', name: 'å„ªã—ã„å¼è­·å£«', line: 'ã¾ãšã¯ã‚ã‚ŠãŒã¨ã†(æ•—è¨´)' },
            { rarity: 'C', name: 'å¼è­·å£«', line: 'å¼è­·ã™ã‚‹ãœ' },
            { rarity: 'C', name: 'ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚³ã‚¢å¼è­·å£«', line: 'ï½¶ï¾ï¾' },
            { rarity: 'C', name: 'chatBGS', line: 'ãã‚Œã€å®Œå…¨ã«**å‹è¨´** !!' },
            { rarity: 'C', name: '24æ™‚é–“å¼è­·å£«', line: 'ä¸çœ ä¸ä¼‘ã§ã‚„ã£ã¦ãŠã‚Šã¾ã™' },
            { rarity: 'C', name: 'é™è„ˆå¼è­·å£«', line: 'é€†ã§ã™ã‚ˆ' },
            { rarity: 'C', name: 'äººç‹¼å¼è­·å£«', line: 'ã¡ã‚‡ã£ã¨æ¤œå¯ŸåŠã‚Šç›¤é¢ã ã­' },
            { rarity: 'C', name: 'fpså¼è­·å£«', line: 'ä»Šè¢«å‘Šæ¿€ãƒ­ãƒ¼æ¿€ãƒ­ãƒ¼' },
            { rarity: 'C', name: 'ä¸€æ—¥å¼è­·å£«', line: 'ã“ã‚Œã‚’æ©Ÿã«ãƒ­ãƒ¼ã‚¹ã‚¯ãƒ¼ãƒ«ã«é€šã„ã¾ã™' },
            { rarity: 'C', name: 'å…ƒå¼è­·å£«', line: 'é«˜æ ¡ã®æ™‚å¼è­·ã—ã¦ãŸã‚“ã™ã‚ˆã­' },
            { rarity: 'C', name: 'å¼è­·å£«OB', line: 'ä¿ºã®é ƒã“ã‚“ãªã®ãªã‹ã£ã¦ã‚“ã§ï¼Ÿ' },
            { rarity: 'C', name: 'ã‚¢ãƒå¼è­·å£«', line: 'çœŒå¤§ä¼šï¼’ä½' },
            { rarity: 'C', name: 'å¼è­·å£«ã‚¢ã‚¤ãƒ‰ãƒ«', line: 'ã¿ã‚“ãªã§ä¸€ç·’ã«ä¸Šå‘Šã—ã‚ˆã†ï¼' },
            { rarity: 'C', name: 'å›½é¸å¼è­·ç«æ˜Ÿäºº', line: '(ç•°æ˜Ÿäººè¨€èªã®éŸ³)' },
            { rarity: 'C', name: 'ã‚¤ã‚­ãƒªå¼è­·å£«', line: 'æ³•å»·ã§æ¨ªæºã‚Œã‹ã¾ãã†ã‚„' },
            { rarity: 'C', name: 'å…‰ã®å¼è­·å£«', line: 'é—‡ã®å¼è­·å£«ã«å¼·ã„ã' },
            { rarity: 'C', name: 'é—‡ã®å¼è­·å£«', line: 'å…‰ã®å¼è­·å£«ã«å¼·ã„ã' },
            { rarity: 'C', name: 'å¤©æ‰å¼è­·å£«çŠ¬', line: 'ãƒ¯ãƒ³ï¼ãƒ¯ãƒ³ãƒ¯ãƒ³ï¼' },
            { rarity: 'C', name: 'ã‚¯ãƒ­ãƒ¼ãƒ³å¼è­·å£«', line: 'ä¿ºã¯ã‚¯ãƒ­ãƒ¼ãƒ³ã˜ã‚ƒãªã„' },
            { rarity: 'C', name: 'æ„Ÿè¦šæ´¾å¼è­·å£«', line: 'ä¿ºã®å‹˜ãŒæ•—è¨´ã£ã¦è¨€ã£ã¦ã‚“ã ã‚' }
        ];

        const RATES = {
            SSR: 0.03,
            SR: 0.12,
            R: 0.35,
            C: 0.50
        };

        const RARITY_ORDER = { 'SSR': 4, 'SR': 3, 'R': 2, 'C': 1 };
        const RARITY_COLORS = {
            'SSR': 'text-yellow-400',
            'SR': 'text-red-400',
            'R': 'text-blue-300',
            'C': 'text-gray-400'
        };

        let gachaHistory = JSON.parse(localStorage.getItem('lawyerGachaHistory')) || [];
        let lastPullCount = 1;

        // === ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ===

        function getRandomChar() {
            const rand = Math.random();
            let selectedRarity = 'C';
            
            if (rand < RATES.SSR) selectedRarity = 'SSR';
            else if (rand < RATES.SSR + RATES.SR) selectedRarity = 'SR';
            else if (rand < RATES.SSR + RATES.SR + RATES.R) selectedRarity = 'R';

            const pool = CHARACTERS.filter(c => c.rarity === selectedRarity);
            return pool[Math.floor(Math.random() * pool.length)];
        }

        async function pullGacha(count) {
            lastPullCount = count;
            const results = [];
            let maxRarity = 0;

            for (let i = 0; i < count; i++) {
                const char = getRandomChar();
                results.push(char);
                if (RARITY_ORDER[char.rarity] > maxRarity) {
                    maxRarity = RARITY_ORDER[char.rarity];
                }
            }

            // å±¥æ­´ä¿å­˜
            results.forEach(r => {
                gachaHistory.push({ ...r, date: new Date().toISOString() });
            });
            localStorage.setItem('lawyerGachaHistory', JSON.stringify(gachaHistory));

            // æ¼”å‡ºé–‹å§‹
            await playAnimation(maxRarity, results);
        }

        // === æ¼”å‡ºãƒ­ã‚¸ãƒƒã‚¯ ===

        async function playAnimation(maxRarity, results) {
            const animScreen = document.getElementById('animation-screen');
            const gavel = document.getElementById('gavel-icon');
            const flash = document.getElementById('flash-overlay');
            const textContainer = document.getElementById('anim-text-container');
            
            animScreen.classList.remove('hidden');
            textContainer.innerHTML = '';
            gavel.style.opacity = '0';
            gavel.style.transform = 'rotate(45deg) scale(0.5)';

            // 1. é™å¯‚ (å°‘ã—å¾…ã¤)
            await wait(300);

            // 2. ã‚¬ãƒ™ãƒ«å‡ºç¾ & æŒ¯ã‚Šã‹ã¶ã‚Š
            gavel.style.opacity = '1';
            gavel.style.transform = 'rotate(45deg) scale(1)';
            await wait(600);

            // 3. å©ãï¼ (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
            gavel.style.transition = 'transform 0.1s cubic-bezier(0.25, 1, 0.5, 1)';
            gavel.style.transform = 'rotate(-10deg) scale(0.9)'; // å©ã„ãŸä½ç½®
            
            // ãƒ‰ãƒ³ï¼ã¨ã„ã†éŸ³ã®è¦–è¦šåŒ–ï¼ˆç”»é¢ã‚·ã‚§ã‚¤ã‚¯ï¼‰
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 500);

            // 4. ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã«å¿œã˜ãŸæ¼”å‡º
            if (maxRarity === 4) { // SSR
                // ç”»é¢æš—è»¢ -> ã‚¹ãƒãƒƒãƒˆãƒ©ã‚¤ãƒˆ -> å‹è¨´
                gavel.style.opacity = '0';
                flash.style.opacity = '1'; // ä¸€ç¬çœŸã£ç™½
                await wait(100);
                flash.style.opacity = '0';
                animScreen.style.backgroundColor = '#000'; // çœŸã£æš—

                // "å‹è¨´" ãƒ†ã‚­ã‚¹ãƒˆãŒé£›ã‚“ã§ãã‚‹
                createFlyingText('å‹', -100);
                await wait(200);
                createFlyingText('è¨´', 100);
                await wait(800);
                
                // è™¹è‰²èƒŒæ™¯ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
                animScreen.classList.add('rainbow-bg');
                createExplosion();
                await wait(1500);
                animScreen.classList.remove('rainbow-bg');
            } else if (maxRarity === 3) { // SR
                // "ç•°è­°ã‚ã‚Šï¼"
                flash.style.opacity = '0.5';
                await wait(100);
                flash.style.opacity = '0';
                createAlertText('ç•°è­°ã‚ã‚Šï¼', 'text-red-500');
                await wait(1200);
            } else {
                // é€šå¸¸æ¼”å‡º "é™ç²›ã«"
                createAlertText('é™ç²›ã«', 'text-stone-400');
                await wait(800);
            }

            // çµ‚äº†å‡¦ç†
            animScreen.classList.add('hidden');
            animScreen.style.backgroundColor = 'black';
            showResults(results);
        }

        function createFlyingText(char, xOffset) {
            const el = document.createElement('div');
            el.innerText = char;
            el.className = 'text-9xl font-black text-white absolute transition-all duration-500 transform scale-0 drop-shadow-[0_0_10px_rgba(255,215,0,0.8)]';
            el.style.left = `calc(50% + ${xOffset}px - 50px)`; // ä¸­å¤®ã‹ã‚‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
            document.getElementById('anim-text-container').appendChild(el);
            
            requestAnimationFrame(() => {
                // ãƒ€ãƒ–ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æç”»ã‚’ç¢ºå®Ÿã«
                requestAnimationFrame(() => {
                    el.style.transform = 'scale(1.5)';
                });
            });
        }

        function createAlertText(text, colorClass) {
            const el = document.createElement('div');
            el.innerText = text;
            el.className = `text-6xl md:text-8xl font-black ${colorClass} absolute transform scale-150 opacity-0 transition-all duration-300 border-4 border-current px-8 py-2 rotate-[-5deg]`;
            document.getElementById('anim-text-container').appendChild(el);
            
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'scale(1) rotate(-5deg)';
                });
            });
        }

        function createExplosion() {
            const container = document.getElementById('animation-screen');
            for(let i=0; i<50; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = ['#ffd700', '#ff0000', '#ffffff'][Math.floor(Math.random()*3)];
                conf.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
                container.appendChild(conf);
                setTimeout(() => conf.remove(), 2000);
            }
        }

        // === çµæœè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ ===

        async function showResults(results) {
            const screen = document.getElementById('result-screen');
            const container = document.getElementById('cards-container');
            const title = document.getElementById('result-title');
            const buttons = document.getElementById('result-buttons');
            
            screen.classList.remove('hidden');
            container.innerHTML = '';
            title.style.opacity = '0';
            buttons.style.opacity = '0';

            // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ (è£é¢çŠ¶æ…‹ã§)
            results.forEach((char, index) => {
                const card = document.createElement('div');
                // åˆæœŸçŠ¶æ…‹ã¯é€æ˜ãƒ»ç¸®å°
                card.className = `relative opacity-0 transform scale-50 transition-all duration-500 group cursor-pointer`;
                card.style.perspective = '1000px';

                const cardInner = `
                    <div class="w-full aspect-[2/3] relative rounded-lg overflow-hidden card-${char.rarity} p-2 flex flex-col justify-between hover:scale-105 transition-transform duration-300">
                        <!-- ãƒ¬ã‚¢ãƒªãƒ†ã‚£è¡¨ç¤º -->
                        <div class="absolute top-2 left-2 z-10 font-black text-xl italic drop-shadow-md ${RARITY_COLORS[char.rarity]} bg-black/50 px-2 rounded">
                            ${char.rarity}
                        </div>
                        
                        <!-- ã‚­ãƒ£ãƒ©ç”»åƒï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰ -->
                        <div class="flex-1 flex items-center justify-center bg-black/20 rounded mt-8 mb-2 mx-1 relative overflow-hidden">
                             ${char.rarity === 'SSR' ? '<div class="absolute inset-0 bg-gradient-to-t from-yellow-500/20 to-transparent animate-pulse"></div>' : ''}
                             <span class="text-4xl filter drop-shadow-lg">
                                ${getIconForChar(char.rarity)}
                             </span>
                        </div>

                        <!-- åå‰ã¨ã‚»ãƒªãƒ• -->
                        <div class="text-center relative z-10">
                            <div class="font-bold text-sm md:text-base leading-tight mb-1 text-white border-b border-white/20 pb-1">
                                ${char.name}
                            </div>
                            <div class="text-[10px] md:text-xs text-gray-300 italic min-h-[2.5em] flex items-center justify-center">
                                "${char.line}"
                            </div>
                        </div>
                    </div>
                `;
                card.innerHTML = cardInner;
                container.appendChild(card);
            });

            // é †ç•ªã«è¡¨ç¤º (Reveal)
            title.style.opacity = '1';
            
            for (let i = 0; i < results.length; i++) {
                const card = container.children[i];
                // å°‘ã—é…å»¶ã•ã›ã¦è¡¨ç¤º
                await wait(100);
                card.style.opacity = '1';
                card.style.transform = 'scale(1)';
                
                // SSRãªã‚‰ç‰¹åˆ¥æ¼”å‡º
                if (results[i].rarity === 'SSR') {
                    card.classList.add('shake');
                    // ã‚­ãƒ©ã‚­ãƒ©è¿½åŠ 
                }
            }

            await wait(500);
            buttons.style.opacity = '1';
        }

        function getIconForChar(rarity) {
            if (rarity === 'SSR') return 'âš–ï¸';
            if (rarity === 'SR') return 'ğŸ–ï¸';
            if (rarity === 'R') return 'ğŸ’¼';
            return 'ğŸ“„';
        }

        // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===

        function closeResult() {
            const screen = document.getElementById('result-screen');
            screen.classList.add('hidden');
            document.getElementById('cards-container').innerHTML = '';
        }

        function retryGacha() {
            closeResult();
            pullGacha(lastPullCount);
        }

        function toggleHistory() {
            const modal = document.getElementById('history-modal');
            const content = document.getElementById('history-content');
            
            if (modal.classList.contains('hidden')) {
                // è¡¨ç¤ºå‡¦ç†
                modal.classList.remove('hidden');
                
                // é›†è¨ˆ
                const counts = {};
                gachaHistory.forEach(item => {
                    counts[item.name] = (counts[item.name] || 0) + 1;
                });

                content.innerHTML = '';
                if (gachaHistory.length === 0) {
                    content.innerHTML = '<div class="text-gray-500 p-4 col-span-full text-center">ã¾ã èª°ã‚‚é›‡ç”¨ã—ã¦ã„ã¾ã›ã‚“</div>';
                    return;
                }

                // å±¥æ­´è¡¨ç¤ºï¼ˆç²å¾—æ•°ã®å¤šã„é †ã€ãƒ¬ã‚¢åº¦é †ï¼‰
                // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚­ãƒ£ãƒ©ãƒªã‚¹ãƒˆã‚’ä½œæˆ
                const uniqueChars = Array.from(new Set(gachaHistory.map(h => h.name)))
                    .map(name => {
                        return gachaHistory.find(h => h.name === name);
                    })
                    .sort((a, b) => RARITY_ORDER[b.rarity] - RARITY_ORDER[a.rarity]);

                uniqueChars.forEach(char => {
                    const div = document.createElement('div');
                    div.className = `p-3 rounded border flex justify-between items-center ${char.rarity === 'SSR' ? 'bg-yellow-900/30 border-yellow-600' : 'bg-stone-700 border-stone-600'}`;
                    div.innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="font-bold w-8 ${RARITY_COLORS[char.rarity]}">${char.rarity}</span>
                            <span class="text-sm font-serif">${char.name}</span>
                        </div>
                        <span class="text-stone-400 text-xs">Ã—${counts[char.name]}</span>
                    `;
                    content.appendChild(div);
                });

            } else {
                modal.classList.add('hidden');
            }
        }

        function resetData() {
            if(confirm('ç²å¾—ã—ãŸå¼è­·å£«ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦ç ´æ£„ã—ã¾ã™ã‹ï¼Ÿ\n(ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“)')) {
                localStorage.removeItem('lawyerGachaHistory');
                gachaHistory = [];
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚');
                // å±¥æ­´ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ã„ã¦ã„ãŸã‚‰é–‰ã˜ã‚‹
                document.getElementById('history-modal').classList.add('hidden');
            }
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>


